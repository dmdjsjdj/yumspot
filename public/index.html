<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YumSpot - 맛집을 찾아보자!</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #E3F2FD; color: #333; margin: 0; padding: 0; }
        .header { text-align: center; padding: 20px; font-size: 24px; font-weight: bold; background-color: #90CAF9; color: white; }
        .header a { color: white; text-decoration: none; }
        .navbar { background-color: #90CAF9; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
        .navbar a:hover { color: #1565C0; text-decoration: none; }
        .center-links { flex: 1; display: flex; justify-content: center; gap: 30px; margin-left: 90px; }
        .center-links a { text-decoration: none; color: white; font-size: 18px; }
        .auth-links { display: flex; gap: 7px; }
        .auth-links a { text-decoration: none; color: white; font-size: 14px; font-weight: normal; }
        .reviews { display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .review-row { display: flex; justify-content: center; gap: 20px; width: 100%; margin-bottom: 10px; flex-wrap: wrap; }
        .review-card { background: white; border-radius: 8px; padding: 15px; width: 250px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; cursor:pointer; }
        .rating { letter-spacing: 1px; }
        .empty { opacity: .4; }
        .meta { color:#555; font-size:12px; }

        /* Footer */
        .app-footer{
        margin-top:40px; background:#76b2e4; color:#EAF4FF;
        }
        .app-footer a{ color:#EAF4FF; text-decoration:none; }
        .app-footer a:hover{ text-decoration:underline; }

        .footer-inner{
        max-width: 1100px; margin:0 auto;
        display:grid; grid-template-columns: 2fr 1fr 1fr;
        gap:16px; padding:28px 16px;
        }
        .footer-brand{ display:flex; gap:12px; align-items:flex-start; }
        .brand-mark{
        width:36px; height:36px; border-radius:10px;
        display:grid; place-items:center;
        background:#90CAF9; color:#76b2e4; font-weight:900;
        }
        .brand-name{ font-weight:800; letter-spacing:.2px; }
        .brand-desc{ color:#CFE3FF; font-size:13px; margin-top:4px; }

        .footer-col h4{
        margin:0 0 8px; font-size:14px; color:#B0D7FF; letter-spacing:.3px;
        }
        .footer-col ul{ list-style:none; margin:0; padding:0; display:grid; gap:6px; }

        .footer-copy{
        border-top:1px solid rgba(255,255,255,.18);
        text-align:center; padding:10px 16px; font-size:12px; color:#CFE3FF;
        }

        @media (max-width: 840px){
        .footer-inner{ grid-template-columns:1fr; }
        }

        /* Header shrink micro-interaction */
        .header,
        .navbar { transition: all .18s ease; }

        /* 기본 높이(현재 네 디자인 기준) */
        .header { padding: 20px; }
        .navbar { padding: 10px; }

        /* 축소 상태 */
        .header.is-compact { padding: 10px; }
        .navbar.is-compact {
        padding: 8px;
        box-shadow: 0 4px 16px rgba(0,0,0,.08);
        backdrop-filter: saturate(140%) blur(2px);
        }
    </style>
    <script src="/utils/categoryLists.js"></script>
</head>
<body>
    <div class="header">
        <a href="/">YumSpot - 맛집을 찾아보자!</a>
    </div>

    <div class="navbar">
        <div class="center-links">
            <a href="regionreview.html">지역별</a>
            <a href="foodreview.html">음식</a>
            <a href="myreview.html">내 리뷰</a>
        </div>
        <div class="auth-links">
            <a href="login.html">로그인</a>
            <a href="signup.html">회원가입</a>
        </div>
    </div>

    <div class="reviews">
        <h2>최근 리뷰</h2>
        <div id="reviewRow" class="review-row"></div>
    </div>



    <script>
        // 날짜 포맷 헬퍼
        function fmtDate(iso) {
            if (!iso) return '-';
            try {
            return new Date(iso).toLocaleDateString('ko-KR', { year:'numeric', month:'2-digit', day:'2-digit' });
            } catch { return '-'; }
        }

        async function showRecentReviews() {
            const row = document.getElementById("reviewRow");
            row.innerHTML = '';
            try {
                const res = await fetch('/api/reviews/recent',  { credentials: 'include' });
                if (!res.ok) {
                const errJson = await res.json().catch(()=> ({}));
                console.error('recent failed:', res.status, errJson);
                throw new Error('리뷰를 불러올 수 없음');
                }

                const reviews = await res.json();
                if (!reviews || reviews.length === 0) {
                    row.innerHTML = '<p>아직 리뷰가 없습니다.</p>';
                    return;
                }

                reviews.forEach(review=>{
                    const card = document.createElement('div');
                    card.className = 'review-card';

                    const rating = Number(review.rating) || 0;
                    const stars = '★'.repeat(rating) + '<span class="empty">' + '☆'.repeat(5-rating) + '</span>';
                    
                    card.innerHTML = `
                        <h3>${review.title}</h3>
                        <p class="rating">${stars}</p>
                        <p>카테고리: ${review.foodcategory ?? '-'}</p>
                        <p>${review.restaurant_name ?? ''}</p>
                        <p class="meta">작성일: ${fmtDate(review.created_at)}</p>
                        <p class="meta">북마크 ${review.bookmark_count ?? 0}</p>
                    `;
                    card.addEventListener('click',()=>location.href=`reviewdetail.html?id=${review.id}`);
                    row.appendChild(card);
                });
            } catch(e) {
                row.innerHTML = '<p>리뷰를 불러오지 못했습니다.</p>';
                console.error(e);
            }
        }
        window.onload = showRecentReviews;
    </script>
    
    <script>
    (async function initAuth() {
    try {
        // 로그인 상태 확인
        const res = await fetch('/check-auth', { credentials: 'include' });
        const data = await res.json();
        if (!data.loggedIn) return;

        // 로그인 시 마이페이지 메뉴 표시
        const authLinks = document.querySelector('.auth-links');
        if (authLinks) {
        authLinks.innerHTML = `
            <div style="position: relative;">
            <button id="mypageBtn" style="background:none;border:none;color:white;cursor:pointer;">마이페이지 ▾</button>
            <div id="mypageDropdown" style="display:none;position:absolute;right:0;background:white;color:black;padding:10px;border-radius:5px;min-width:100px;">
                <a href="mypage.html" style="color:black;text-decoration:none;">내 정보 확인</a><br>
                <a href="editprofile.html" style="color:black;text-decoration:none;">프로필 수정</a><br>
                <a href="#" id="logoutLink" style="color:black;text-decoration:none;">로그아웃</a>
            </div>
            </div>`;
        document.getElementById("mypageBtn")?.addEventListener("click", () => {
            const d = document.getElementById("mypageDropdown");
            d.style.display = d.style.display === "none" ? "block" : "none";
        });
        document.getElementById("logoutLink")?.addEventListener("click", (e) => {
            e.preventDefault();
            fetch('/logout', { credentials: 'include' }).then(() => location.href = '/');
        });
        }

        // 관리자 계정이면 '관리자' 링크 추가
        const meRes = await fetch('/api/me', { credentials: 'include' });
        if (meRes.ok) {
        const me = await meRes.json();
        if (me?.role === 'admin') {
            const center = document.querySelector('.center-links');
            if (center && !center.querySelector('a[href="admin-reports.html"]')) {
            const a = document.createElement('a');
            a.href = 'admin-reports.html';
            a.textContent = '관리자';
            center.appendChild(a);
            }
        }
        }
    } catch (e) {
        console.error('Auth init error:', e);
    }
    })();
    </script>

    <script>
    // 헤더/네비 DOM
    const _hdr = document.querySelector('.header');
    const _nav = document.querySelector('.navbar');

    let _last = 0;
    let _raf = 0;

    function onScrollCompact(){
    const y = window.scrollY || document.documentElement.scrollTop || 0;
    const compact = y > 16;              // 임계값 (16px 이후 축소)
    if (_hdr) _hdr.classList.toggle('is-compact', compact);
    if (_nav) _nav.classList.toggle('is-compact', compact);
    _raf = 0;
    }

    window.addEventListener('scroll', () => {
    // requestAnimationFrame으로 성능 부담 ↓
    if (_raf) return;
    _raf = requestAnimationFrame(onScrollCompact);
    });

    // 초기 상태도 한 번 반영
    onScrollCompact();
    </script>

    <footer class="app-footer">
        <div class="footer-inner">
            <div class="footer-brand">
                <div class="brand-mark">YS</div>
                    <div class="brand-text">
                        <div class="brand-name">YumSpot</div>
                        <div class="brand-desc">리뷰 중심 맛집 커뮤니티. 가볍게 쓰고, 빠르게 찾자!</div>
                    </div>
                </div>

                <div class="footer-col">
                <h4>바로가기</h4>
                <ul>
                    <li><a href="regionreview.html">지역별</a></li>
                    <li><a href="foodreview.html">음식</a></li>
                    <li><a href="myreview.html">내 리뷰</a></li>
                </ul>
                </div>

                <div class="footer-col">
                <h4>정보</h4>
                <ul>
                    <li><a href="#">이용약관</a></li>
                    <li><a href="#">개인정보처리방침</a></li>
                    <li><a href="mailto:contact@yumspot.app">contact@yumspot.app</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-copy">© 2025 YumSpot. All rights reserved.</div>
    </footer>

</body>
</html>
